- name: Check if backup exists
  ansible.builtin.stat:
    path: /etc/ssh/sshd_config.bak
  register: backup_exists

- name: Create backup file
  ansible.builtin.file:
    path: /etc/ssh/sshd_config.bak
    state: touch
    mode: '0644'
  when: not backup_exists

- name: Copy a backup data to .bak file
  ansible.builtin.copy:
    src: /etc/ssh/sshd_config
    dest: /etc/ssh/sshd_config.bak
    backup: yes

- name: Deploy sshd_config configuration file
  ansible.builtin.template:
    src: sshd_config_template.j2
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: '0644'

- name: Check banner file exists
  ansible.builtin.stat:
    path: /etc/ssh/ssh_banner
  register: banner_file

- name: Create banner file
  ansible.builtin.file:
    path: /etc/ssh/ssh_banner
    state: touch
    mode: '0644'
  when: not banner_file

- name: Deploy banner config
  ansible.builtin.template: 
    src: banner_info.j2
    dest: "{{ sshd_banner }}"
  notify: Deploy banner config
